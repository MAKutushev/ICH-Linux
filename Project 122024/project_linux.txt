Проект состоял в восстановлении работы веб-сервера на Linux. На сервере установлены веб-приложение и Apache, а также настроены бекапы, однако по неизвестной причине сервис перестал работать.

Этапы работы

Проверка доступности сайта
После получения IP-адреса сервера (http://18.192.103.67/) было замечено, что сайт не работает.

Подключение к серверу через SSH
Для подключения к серверу использовалась команда:

ssh -i ich.pem ec2-user@18.192.103.67
-i ich.pem указывает на приватный ключ для аутентификации,
ec2-user — имя пользователя на сервере.

Проверка состояния Apache
Для проверки статуса Apache использовалась команда:

sudo service httpd status
Ответ показал, что сервис не работает (inactive).

Запуск Apache
Для запуска Apache использовалась команда:


sudo service httpd start
После этого статус сервиса изменился на активный (active).

Проверка конфигурации приложения
Файл конфигурации был найден по пути:

/home/ec2-user/LocalSettings\ \(5\).php
При попытке копирования файла возникла ошибка, связанная с нехваткой места на устройстве:


cp /home/ec2-user/LocalSettings\ \(5\).php /var/www/html/mediawiki/LocalSettings.php
Проверка свободного места на диске
Для того чтобы проверить, сколько места доступно на сервере, была выполнена команда:


df -h
Результат показал, что раздел /dev/nvme0n1p1 был полностью заполнен.

Для поиска больших файлов использовалась команда:


find / -type f -size +100M
Было обнаружено, что файл логов Apache занимал 7 ГБ.

Очистка логов
Для очистки файла логов использовалась команда:


sudo echo "" > /var/log/httpd/access_log
После этого освободилось место на диске.

Исправление конфигурации
Файл конфигурации был успешно скопирован, и в нем был обновлен IP-адрес на актуальный.

Автоматизация очистки логов
Был создан скрипт для автоматической архивации логов:


#!/bin/bash

LOG_DIR="/var/log/httpd"
LOG_FILE="access_log"
BACKUP_DIR="/var/backups"
MAX_BACKUPS=3
DATE=$(date +%Y%m%d)
ARCHIVE="$BACKUP_DIR/$LOG_FILE-$DATE.tar.gz"

tar -czf "$ARCHIVE" "$LOG_DIR/$LOG_FILE"
find "$BACKUP_DIR" -type f -name "$LOG_FILE-*.tar.gz" -mtime +3 -exec rm {} \;
Также был добавлен cron-запуск:


0 0 * * * /home/ec2-user/backup_logs.sh

В ходе работы были решены основные проблемы, включая:

Перезапуск веб-сервера,
Освобождение места на диске,
Исправление конфигурации приложения,
Настройка автоматической очистки логов.
Сайт был успешно восстановлен и снова стал доступен.